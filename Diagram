// user features
Table roles {
  id int [pk]
  role_name varchar(50)
}

Enum genders {
  MALE
  FEMALE
  NONE
}

Table departments {
  id int [pk, ref: < users_departments.department_id]
  department_name varchar(255)
  created_at timestamp
  updated_at timestamp
}

Table users {
  id int [pk, ref: <> users_departments.user_id,
  ref: - freecycle_posts.user_id,
  ref: < volunteer_events.user_created_event_id,
  ref: < volunteer_event_participation.participated_user_id,
  ref: < onsite_enrollments.user_id,
  ref: - reports.user_id,
  ref: < emergency_contacts.user_id,
  ref: < messages.sender_id,
  ref: < messages.recipient_id,
  ref: < users_contacts.user_id,
  ref: < users_contacts.contact_user_id]

  username varchar(25)
  first_name varchar(255)
  middle_name varchar(255)
  last_name varchar(255)
  gender genders
  role_id int [ref: - roles.id]
  password_hash varchar(256) [not null]
  email varchar(255) [unique]
  phone varchar(15) [unique]
  address text [not null]
  birth_date timestamp [not null]
  created_at timestamp
  updated_at timestamp
}

Table users_departments {
  user_id int [pk]
  department_id int [pk]
}

// G4 Freecycle
Table freecycle_posts {
  id int [pk, ref: < freecycle_posts_categories.post_id]
  item_name varchar(100) [not null]
  photo_url text [not null]
  description text [not null]
  user_id int
  department_id int [ref: - departments.id]
  is_given boolean [default: false]
  created_at timestamp
  updated_at timestamp
}

Table freecycle_categories {
  id int [pk, ref: < freecycle_posts_categories.category_id]
  category_name varchar(100)
  created_at timestamp
  updated_at timestamp
}

Table freecycle_posts_categories {
  post_id int [pk]
  category_id int [pk]
}

// G6 Volunteer
Enum volunteer_event_status {
  DRAFT
  PENDING
  APPROVED
  REJECTED
}

Table volunteer_events {
  id int [pk, ref: < volunteer_event_participation.volunteer_event_id]
  user_created_event_id int
  title varchar(255) [not null]
  description text [not null]
  start_date timestamp
  end_date timestamp
  register_deadline timestamp
  location text
  status volunteer_event_status
  created_at timestamp
  updated_at timestamp
}

Table volunteer_event_participation {
  id int [pk]
  volunteer_event_id int
  participated_user_id int
  current_participator int [default: 0, not null]
  avaliable_seat int [not null, default: 0]
  total_seat int [not null, default: 1]
  created_at timestamp
  updated_at timestamp
}

// G1 Know Ai Courses
Enum course_types {
  ONLINE
  ONSITE
  ONLINE_AND_ONSITE
}

Table online_courses {
  id int [pk]
  video_name varchar(100) [not null]
  video_description text [not null]
  duration_minutes decimal [not null]
  video_order int [not null]
  video_file_path text [not null]
  course_id int [not null]
  created_at timestamp
  updated_at timestamp
}

Table onsites {
  id int [pk, ref: < onsite_enrollments.onsite_id]
  course_id int
  event_venue text [not null]
  duration_hours decimal
  event_datetime timestamp [not null]
  registration_deadline timestamp [not null]
  avaliable_seat int [not null, default: 0]
  total_seat int [not null, default: 1]
  created_at timestamp
  updated_at timestamp
}

Table onsite_enrollments {
  id int [pk]
  onsite_id int
  user_id int [pk]
}

Table courses {
  id int [pk, ref: < online_courses.course_id,
    ref: < onsites.id]
  course_name varchar(255) [not null]
  course_description text [not null]
  course_type course_types [not null]
  cover_image text [not null]
  created_at timestamp
  updated_at timestamp
}

// G3 Event Hub
Table event {
  id int [pk]
  title varchar(50)
  description varchar(255)
  date timestamp
  location text
  organizerEmail varchar(255)
  postedByAdminId int
}

Table bookmark {
  userId int [pk, ref: < users.id]
  eventId int [pk, ref: < event.id]
  createdAt timestamp
}

// G12 Healthcare
Table patients {
  patient_id int [pk]
  user_id int [ref: - users.id]
  emergency_contact varchar(200)
  finance_id int
  housing_id int
  sos_id int
  created_at timestamp
}

Table facilities {
  facility_id int [pk]
  name varchar(255)
  type varchar(50)
  address text
  phone varchar(20)
  latitude decimal(10,8)
  longitude decimal(11,8)
  emergency_services boolean
  finance_merchant_id int
  housing_zone varchar(100)
  sos_code varchar(50)
  department_id int [ref: > departments.id]
  created_at timestamp
}

Table beds {
  bed_id int [pk]
  facility_id int [ref: > facilities.facility_id]
  bed_number varchar(20)
  bed_type varchar(50)
  status varchar(20)
  patient_id int [ref: - patients.patient_id]
  admission_date timestamp
  finance_billing_id int
  sos_priority integer
}

Table appointments {
  appointment_id int [pk]
  patient_id int [ref: - patients.patient_id]
  facility_id int [ref: > facilities.facility_id]
  user_id int [ref: > users.id]
  appointment_datetime timestamp
  type varchar(50)
  status varchar(20)
  finance_payment_id int
  housing_transport_id int
  sos_emergency boolean
  created_at timestamp
}

Table prescriptions {
  prescription_id int [pk]
  patient_id int [ref: - patients.patient_id]
  user_id int [ref: - users.id]
  facility_id int [ref: > facilities.facility_id]
  medication_name varchar(255)
  quantity integer
  status varchar(20)
  finance_payment_id int
  housing_delivery_id int
  sos_critical boolean
  created_at timestamp
}

Table ambulances {
  ambulance_id int [pk]
  vehicle_number varchar(50)
  status varchar(20)
  current_latitude decimal(10,8)
  current_longitude decimal(11,8)
  base_facility_id int [ref: > facilities.facility_id]
  finance_rate decimal(10,2)
  housing_coverage_zones json
  sos_priority integer
  created_at timestamp
}

Table emergency_calls {
  emergency_id int [pk]
  patient_id int [ref: - patients.patient_id]
  caller_phone varchar(20)
  emergency_type varchar(50)
  severity varchar(20)
  location_address text
  ambulance_id int [ref: > ambulances.ambulance_id]
  facility_id int [ref: > facilities.facility_id]
  status varchar(20)
  finance_billing_id int
  housing_unit varchar(100)
  sos_incident_id int
  created_at timestamp
}

Table payments {
  payment_id int [pk]
  patient_id int [ref: - patients.patient_id]
  facility_id int [ref: > facilities.facility_id]
  service_type varchar(50)
  service_id int
  amount decimal(10,2)
  currency varchar(3)
  payment_method varchar(50)
  insurance_coverage decimal(10,2)
  patient_copay decimal(10,2)
  status varchar(20)
  payment_date timestamp
  finance_transaction_id int
  insurance_claim_id int
  created_at timestamp
  updated_at timestamp
}

Table team_integrations {
  integration_id int [pk]
  team_name varchar(50)
  healthcare_table varchar(50)
  healthcare_id varchar
  external_id varchar(100)
  data_type varchar(50)
  status varchar(20)
  additional_data json
  created_at timestamp
}

// G11 Financial
Enum wallet_type {
  individual
  organization
}

Enum wallet_status {
  active
  suspended
}

Table wallets {
  wallet_id int [pk]
  owner_id int [unique, ref: - users.id]
  wallet_type wallet_type
  organization_type varchar(100)
  balance decimal [default: 0.0]
  status wallet_status
  created_at timestamp
  updated_at timestamp
}

Enum transaction_type {
  top_up
  transfer_in
  transfere_out
  transfer_to_service
}

Enum target_services {
  insurance
  metro
  null
}

Table wallet_transactions {
  transaction_id int [pk]
  wallet_id int [ref: > wallets.wallet_id]
  transaction_type transaction_type
  amount decimal
  target_wallet_id int
  target_service target_services
  description varchar(255)
  created_at timestamp
}

Table insurance_cards {
  card_id int [pk]
  citizen_id int [ref: - users.id]
  balance decimal [default: 0.0]
  card_number int [unique]
  status wallet_status
  created_at timestamp
  updated_at timestamp
}

Table metro_cards {
  card_id int [pk]
  citizen_id int [ref: - users.id]
  balance decimal [default: 0.0]
  card_number int [unique]
  status wallet_status
  created_at timestamp
  updated_at timestamp
}

Enum card_transaction_type {
  top_up
  charge
  refund
}

Enum transaction_category {
  insurance
  metro
}

Table transaction {
  transaction_id int [pk]
  card_id int [ref: > insurance_cards.card_id]
  transaction_type card_transaction_type
  transaction_category transaction_category
  reference varchar(50)
  amount decimal [default: 0.0]
  description varchar(255)
  created_at timestamp
}

// G10 Traffic
Table traffic_light {
  light_id int [pk]
  latitude varchar(100)
  longitude varchar(100)
  status boolean
  current_color int
  density_level int
  auto_mode boolean
  last_updated timestamp
}

Table intersection {
  intersection_id int [pk]
  latitude varchar(100)
  longitude varchar(100)
}

Table light_request {
  request_id int [pk]
  light_id int [ref: > traffic_light.light_id]
  request_time timestamp
}

Table road {
  road_id int [pk]
  light_id int [ref: < traffic_light.light_id]
  intersection_id_start int [ref: > intersection.intersection_id]
  intersection_id_end int [ref: > intersection.intersection_id]
  length int
}

Enum traffic_emergency_status {
  active
  resolve
}

Table traffic_emergency_request {
  emergency_request int [pk]
  user_id int [ref: > users.id]
  accident_latitude varchar(100)
  accident_longitude varchar(100)
  destination_hospital varchar(255)
  status traffic_emergency_status
  ambulance_id int [ref: <> vehicle.vehicle_id]
}

Table vehicle {
  vehicle_id int [pk]
  user_id int [ref: > users.id]
  current_latitude varchar(100)
  current_longitude varchar(100)
  vehicle_plate varchar(10)
}

// G13 Emergency Reports
Enum level {
  near_miss
  minor
  moderate
  major
  lethal
}

Enum report_status {
  pending
  verified
  resolved
}

Enum report_category {
  traffic
  disaster
  crime
}

Table reports {
  report_id int [pk, not null]
  user_id int [not null]
  image varchar(255) [not null]
  description varchar(255) [not null]
  latitude varchar(255) [not null]
  longitude varchar(255) [not null]
  level level
  status report_status
  category report_category
  updated_at timestamp
  created_at timestamp
}

Table emergency_contacts {
  contact_id int [pk, not null]
  user_id int [not null]
  contact_name varchar(255) [not null]
  phone varchar(10)
}

Table alerts {
  alert_id int [pk, not null]
  report_id int [not null]
  message text [not null]
  area varchar(255)
  sent_at timestamp
}

Table users_contacts {
  contact_id int [pk, not null]
  user_id int [not null]
  contact_user_id int [not null]
}

Table messages {
  message_id int [pk, not null]
  sender_id int [not null]
  recipient_id int [not null]
  message_text text
  sent_at timestamp
  conversation_id int [not null]
}

Table conversations {
  conversation_id int [pk, not null, ref: < messages.conversation_id]
  conversation_name varchar(255)
}

// G5 Air Quality
Enum categories {
  GOOD
  MODERATE
  UNHEALTHY
  HAZARDDOUS
}

Table air_quality {
  id int [pk]
  location text [not null]
  aqi decimal
  pm25 decimal
  pm10 decimal
  co decimal
  no2 decimal
  so2 decimal
  o3 decimal
  category categories
  created_at timestamp
}

Table weather_context {
  id int [pk]
  rain_forecast decimal
  created_at timestamp
}

Table traffic_context {
  id int [pk]
  congestion_level decimal
  created_at timestamp
}

//G8 transportation
enum transportation_digital_card_status {
  active
  inactive
}

table digital_card {
  card_id int [pk, increment]
  user_id int [ref: > users.id]
  status transportation_digital_card_status
}

enum transportation_card_transaction_status {
  pending
  confirmed
  failed
}

table transportation_card_transaction {
  transaction_id int [pk, increment]
  card_id int [ref: > digital_card.card_id]
  route_id int [ref: > route.route_id]
  amount decimal
  status transportation_card_transaction_status
  timestamp timestamp
}

table transportation_vehicle_type {
  type_id int [pk, increment]
  type_name varchar(100)
}

enum transportation_vehicle_status {
  active
  maintenance
}

table transportation_vehicle {
  vehicle_id int [pk, increment]
  type_id int [ref: > transportation_vehicle_type.type_id]
  route_id int [ref: > route.route_id]
  current_latitude varchar(100)
  current_longitude varchar(100)
  status transportation_vehicle_status
}

table route {
  route_id int [pk, increment]
  route_name varchar(255)
  type_id int [ref: < transportation_vehicle_type.type_id]
}

table stop {
  stop_id int [pk, increment]
  stop_name varchar(255)
  stop_latitude varchar(100)
  stop_longitude varchar(100)
}

table route_stop {
  route_stop_id int [pk, increment]
  route_id int [ref: > route.route_id]
  stop_id int [ref: > stop.stop_id]
  stop_order int
  travel_time_to_next_stop int [note: "record in minutes"]
}

table transportation_user_request {
  request_id int [pk, increment]
  user_id int [ref: > users.id]
  origin_stop_id int [ref: > stop.stop_id]
  destinaion_stop_id int [ref: > stop.stop_id]
  fastest_route_id int [ref: > route.route_id]
  total_travel_time int [note: "record in minutes"]
  timestamp timestamp
}
